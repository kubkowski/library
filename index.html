<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Library</title>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
</head>
<body>

	<ul class="nav nav-pills">
  	<li role="presentation" id="authors" class="active"><a href="#/authors">Authors</a></li>
  	<li role="presentation" id="books"><a href="#/books">Books</a></li>
  	<li role="presentation" id="publishers"><a href="#/publishers">Publishers</a></li>
	</ul>
	<div class="container"></div>


	<script id="authors-list" type="text/template">
		<h1>Authors</h1>
		<a href="#/authors/new" class="btn btn-primary">New author</a>
		<hr />
		<table class="table striped">
			<thead>
				<tr>
					<th>First name</th>
					<th>Last name</th>
					<th></th>
				</tr>
			</thead>
			<tbody class="page">							

			</tbody>
		</table>
	</script>

	<script id="authors-list-item" type="text/template">	
		<td><%= htmlEncode(first_name) %></td>
		<td><%= htmlEncode(last_name) %></td>
		<td><a href="#/authors/edit/<%= id %>" class="btn btn-primary">Edit Author</a>
		<a href="#/authors/delete/<%= id %>" class="btn btn-danger">Delete Author</a></td>
	</script>

	<script id='edit-author' type='text/template'>
		<h1>Authors</h1>
		<hr />
		<form class="edit-author-form">
			<legend><%= author ? 'Update' : 'Create' %> author:</legend>
			<label>First name :</label>
			<input type="text" name="first_name" value="<%= author ? author.get('first_name') : '' %>" />
			<label>Last name :</label>
			<input type="text" name="last_name" value="<%= author ? author.get('last_name') : '' %>" />
			<hr />
			<button type="submit" class="btn"><%= author ? 'Update' : 'Create' %></button>
			<% if (author) { %>
				<input type="hidden" name="id" value="<%= author.id %>" />
				<button type= "button" class="btn btn-danger delete">Delete</button>
			<% } %>
			<button type="button" class="btn btn-success return">Return to list</button>
		</form>
	</script>

	<script id="publishers-list" type="text/template">
		<h1>Publishers</h1>
		<a href="#/publishers/new" class="btn btn-primary">New publisher</a>
		<hr />
		<table class="table striped">
			<thead>
				<tr>
					<th>Name</th>
					<th>Established in</th>
					<th></th>
				</tr>
			</thead>
			<tbody class="page">							

			</tbody>
		</table>
	</script>

	<script id="publishers-list-item" type="text/template">
		<td><%= htmlEncode(name) %></td>
		<td><%= htmlEncode(established_year) %></td>
		<td><a href="#/publishers/edit/<%= id %>" class="btn btn-primary">Edit Publisher</a></td>
	</script>

	<script id='edit-publisher' type='text/template'>
		<h1>Publishers</h1>
		<hr />
		<form class="edit-publisher-form">
			<legend><%= publisher ? 'Update' : 'Create' %> publisher:</legend>
			<label>Name :</label>
			<input type="text" name="name" value="<%= publisher ? publisher.get('name') : '' %>" />
			<label>Established in :</label>
			<input type="text" name="established_year" value="<%= publisher ? publisher.get('established_year') : '' %>" />
			<hr />
			<button type="submit" class="btn"><%= publisher ? 'Update' : 'Create' %></button>
			<% if (publisher) { %>
				<input type="hidden" name="id" value="<%= publisher.id %>" />
				<button type= "button" class="btn btn-danger delete">Delete</button>
			<% } %>
			<button type="button" class="btn btn-success return">Return to list</button>
		</form>
	</script>

	<script id="books-list" type="text/template">
		<h1>Books</h1>
		<a href="#/books/new" class="btn btn-primary">New book</a>
		<hr />
		<table class="table striped">
			<thead>
				<tr>
					<th>Author</th>
					<th>Title</th>
					<th>ISBN</th>
					<th>Publisher</th>
					<th>Year</th>
					<th></th>
				</tr>
			</thead>
			<tbody class="page">							

			</tbody>
		</table>
	</script>

	<script id="books-list-item" type="text/template">
		<td><%= htmlEncode(author.first_name + " " + author.last_name) %></td>
		<td><%= htmlEncode(title) %></td>
		<td><%= htmlEncode(ISBN) %></td>
		<td><%= htmlEncode(publisher.name) %></td>
		<td><%= htmlEncode(published_year) %></td>
		<td><a href="#/books/edit/<%= id %>" class="btn btn-primary">Edit Book</a></td>
	</script>

	<script id='edit-book' type='text/template'>
		<h1>Books</h1>
		<hr />
		<form class="edit-book-form">
			<legend><%= book ? 'Update' : 'Create' %> book:</legend>
			<label>Title :</label>
			<input type="text" name="title" value="<%= book ? book.get('title') : '' %>" />
			<label>Author :</label>

			<label>ISBN :</label>
			<input type="text" name="ISBN" value="<%= book ? book.get('ISBN') : '' %>" />
			<label>Publisher :</label>		

			<label>Year :</label>

			<hr />
			<button type="submit" class="btn"><%= book ? 'Update' : 'Create' %></button>
			<% if (book) { %>
				<input type="hidden" name="id" value="<%= book.id %>" />
				<button type= "button" class="btn btn-danger delete">Delete</button>
			<% } %>
			<button type="button" class="btn btn-success return">Return to list</button>
		</form>
	</script>	
	
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script>	
	<script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/js/bootstrap.min.js"></script>
	<script src="/app/models/author.js"></script>
	<script src="/app/models/book.js"></script>
	<script src="/app/models/publisher.js"></script>
	<script src="/app/collections/authors.js"></script>
	<script src="/app/collections/books.js"></script>
	<script src="/app/collections/publishers.js"></script>
	<script src="/app/helpers/applicationhelper.js"></script>
	<script src="/app/views/authors.js"></script>
	<script src="/app/views/books.js"></script>
	<script src="/app/views/publishers.js"></script>

	<script type="text/javascript">

		Router = Backbone.Router.extend({
			routes: {
				'': 'authorsList',
				'authors': 'authorsList',
				'authors/new': 'editAuthor',
				'authors/edit/:id': 'editAuthor',
				'authors/delete/:id' : 'deleteAuthor',
				'publishers' : 'publishersList',
				'publishers/new': 'editPublisher',
				'publishers/edit/:id': 'editPublisher',
				'books' : 'booksList',
				'books/new' : 'editBook',
				'books/edit/:id' : 'editBook'
			}
		
		});

		var router = new Router();

		router.on('route:authorsList', function(){			
			$('li').removeClass('active');
			$('li#authors').addClass('active');
			var header = new AuthorsListHeader();
			header.render();
			var authorsList = new AuthorsList();
			authorsList.render();
		});

		router.on('route:editAuthor', function(id){
			var editAuthor = new EditAuthor();
			editAuthor.render({id: id});
		});

		router.on('route:deleteAuthor', function(id){
			var author = new Author({id: id});
			if (confirm('Are you sure you want to delete that author?')) {
				author.destroy({
				success: function(){
					router.navigate('/authors', {trigger:true});
				}
			});
			}
		});

		router.on('route:publishersList', function(){
			$('li').removeClass('active');
			$('li#publishers').addClass('active');
			var header = new PublishersListHeader();
			header.render();
			var publishersList = new PublishersList();
			publishersList.render();
		});

		router.on('route:editPublisher', function(id){
			var editPublisher = new EditPublisher();
			editPublisher.render({id: id});
		});

		router.on('route:booksList', function(){
			$('li').removeClass('active');
			$('li#books').addClass('active');
			var header = new BooksListHeader();
			header.render();
			var booksList = new BooksList();
			booksList.render();
		});

		router.on('route:editBook', function(id){
			var editBook = new EditBook();
			editBook.render({id: id});
		});

		Backbone.history.start();

	</script>
		
</body>
</html>