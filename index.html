<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Library</title>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
</head>
<body>

	<div class="container"></div>

	<script id="authors-list" type="text/template">
		<h1>Authors</h1>
		<a href="#/authors/new" class="btn btn-primary">New author</a>
		<hr />
		<table class="table striped">
			<thead>
				<tr>
					<th>First name</th>
					<th>Last name</th>
					<th></th>
				</tr>
			</thead>
			<tbody class="page">							

			</tbody>
		</table>
	</script>

	<script id="authors-list-item" type="text/template">	
		<td><%= htmlEncode(first_name) %></td>
		<td><%= htmlEncode(last_name) %></td>
		<td><a href="#/authors/edit/<%= id %>" class="btn btn-primary">Edit Author</a></td>
	</script>

	<script id='edit-author' type='text/template'>
		<h1>Authors</h1>
		<hr />
		<form class="edit-author-form">
			<legend><%= author ? 'Update' : 'Create' %> author:</legend>
			<label>First name:</label>
			<input type="text" name="first_name" value="<%= author ? author.get('first_name') : '' %>" />
			<label>Last name:</label>
			<input type="text" name="last_name" value="<%= author ? author.get('last_name') : '' %>" />
			<hr />
			<button type="submit" class="btn"><%= author ? 'Update' : 'Create' %></button>
			<% if (author) { %>
				<input type="hidden" name="id" value="<%= author.id %>" />
				<button type= "button" class="btn btn-danger delete">Delete</button>
			<% } %>
		</form>
	</script>

	<script id="publishers-list" type="text/template">
		<h1>Publishers</h1>
		<a href="#/publishers/new" class="btn btn-primary">New publisher</a>
		<hr />
		<table class="table striped">
			<thead>
				<tr>
					<th>Name</th>
					<th>Established in</th>
					<th></th>
				</tr>
			</thead>
			<tbody class="page">							

			</tbody>
		</table>
	</script>

	<script id="publishers-list-item" type="text/template">
		<td><%= htmlEncode(name) %></td>
		<td><%= htmlEncode(established_year) %></td>
		<td><a href="#/publishers/edit/<%= id %>" class="btn btn-primary">Edit Publisher</a></td>
	</script>

	<script id='edit-publisher' type='text/template'>
		<h1>Publishers</h1>
		<hr />
		<form class="edit-publisher-form">
			<legend><%= publisher ? 'Update' : 'Create' %> publisher:</legend>
			<label>Name</label>
			<input type="text" name="name" value="<%= publisher ? publisher.get('name') : '' %>" />
			<label>Established in:</label>
			<input type="text" name="established_year" value="<%= publisher ? publisher.get('established_year') : '' %>" />
			<hr />
			<button type="submit" class="btn"><%= publisher ? 'Update' : 'Create' %></button>
			<% if (publisher) { %>
				<input type="hidden" name="id" value="<%= publisher.id %>" />
				<button type= "button" class="btn btn-danger delete">Delete</button>
			<% } %>
		</form>
	</script>

		
	
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script>	
	<script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/js/bootstrap.min.js"></script>
	<script src="/app/models/author.js"></script>
	<script src="/app/models/publisher.js"></script>
	<script src="/app/collections/authors.js"></script>
	<script src="/app/collections/publishers.js"></script>
	<script src="/app/helpers/applicationhelper.js"></script>
	<script src="/app/views/authors.js"></script>
	<script src="/app/views/publishers.js"></script>

	<script type="text/javascript">

		Router = Backbone.Router.extend({
			routes: {
				'': 'authorsList',
				'authors': 'authorsList',
				'authors/new': 'editAuthor',
				'authors/edit/:id': 'editAuthor',
				'publishers' : 'publishersList',
				'publishers/new': 'editPublisher',
				'publishers/edit/:id': 'editPublisher'
			}
		
		});

		var router = new Router();

		router.on('route:authorsList', function(){			
			var header = new AuthorsListHeader();
			header.render();
			var authorsList = new AuthorsList();
			authorsList.render();
		});

		router.on('route:editAuthor', function(id){
			var editAuthor = new EditAuthor();
			editAuthor.render({id: id});
		});

		router.on('route:publishersList', function(){
			var header = new PublishersListHeader();
			header.render();
			var publishersList = new PublishersList();
			publishersList.render();
		});

		router.on('route:editPublisher', function(id){
			console.log('ok');
			var editPublisher = new EditPublisher();
			editPublisher.render({id: id});
		});

		Backbone.history.start();

	</script>
		
</body>
</html>