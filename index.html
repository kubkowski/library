<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Library</title>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
</head>
<body>

	<div class="container">
		<a href="#/">New user</a> <!-- To do: finish adding new author -->
		<h1>Authors</h1>
		<hr />
		<table class="table striped">
			<thead>
				<tr>
					<th>First name</th>
					<th>Last name</th>
					<th></th>
				</tr>
			</thead>
			<tbody class="page">							

			</tbody>
		</table>

	</div>
	
	<script id="authors-list-item" type="text/template">	
		<td><%= htmlEncode(first_name) %></td>
		<td><%= htmlEncode(last_name) %></td>
		<td></td>
	</script>

	<script id="publishers-list-item" type="text/template">
		<td><%= htmlEncode(name) %></td>
		<td><%= htmlEncode(established_year) %></td>
		<td></td>
	</script>


	
	
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script>	
	<script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/js/bootstrap.min.js"></script>
	<script src="/app/models/author.js"></script>
	<script src="/app/models/publisher.js"></script>
	<script src="/app/collections/authors.js"></script>
	<script src="/app/collections/publishers.js"></script>
	<script src="/app/views/authors.js"></script>
	<script src="/app/views/publishers.js"></script>

	<script type="text/javascript">

		// XSS Protection
		function htmlEncode(value){
  		return $('<div/>').text(value).html();
		}

		function htmlDecode(value){
  		return $('<div/>').html(value).text();
		}
		
		//Ajax Prefilter
		$.ajaxPrefilter( function( options, originalOptions, jqXHR ) {
  		options.url = 'https://safe-dusk-6297.herokuapp.com/api' + options.url;
		});

		var Router = Backbone.Router.extend({
			routes: {
				'authors': 'authorsList',
				'publishers' : 'publishersList'
			},
			authorsList: function(){
				var self = this;
				$(".page").empty();
				this.authors = new Authors();
				this.authorsListView = new AuthorsListView();
				this.authorsListView.authors = this.authors;
				this.authors.fetch().success(function() {
        	self.authorsListView.render();
      	});
			},
			publishersList: function(){
				var self = this;
				$(".page").empty();
				this.publishers = new Publishers();
				this.publishersListView = new PublishersListView();
				this.publishersListView.publishers = this.publishers;
				this.publishers.fetch().success(function(){
					self.publishersListView.render();
				});
			}
		});

		var router = new Router();
		Backbone.history.start();

	</script>
		
</body>
</html>